function imageSprite(t,e,o,i){return i&&(t+=" "+i),IMG({src:"https://d3ptyyxy2at9ui.cloudfront.net/blank-76084e.gif",width:e,height:o,c:t})}function imageSpriteMO(t,e,o,i,s){s=s?" "+s:"",t+=s,e+=s;var r=imageSprite(t,o,i);return $AEV(r,"mouseover",function(){$addClass(r,e),$removeClass(r,t)}),$AEV(r,"mouseout",function(){$hasClass(r,"frozen")||($removeClass(r,e),$addClass(r,t))}),r}function checkEmail(t){return-1!=t.indexOf("@")&&-1!=t.indexOf(".")}function updateGBDimensions(t,e){try{if(window.DISABLE_GB_AUTO_RESIZE)return!0;t&&(window.MIN_HEIGHT=t),t=window.MIN_HEIGHT;var o=$body(),i=o.scrollHeight||o.offsetHeight;i<t&&(i=t),i+=15,top.postMessage&&top.postMessage("greybox_change_height."+i,"*"),e&&top.postMessage&&top.postMessage("greybox_change_width."+e,"*")}catch(t){return $log(t),!1}}ArrowTop={generate:function(t,e,o){t||(t="left");var i={c:"arrow_top",style:"text-align: "+t};return"black"==e?1==o?DIV(i,imageSprite("cmp_arrow_down_dark",25,6)):DIV(i,imageSprite("cmp_arrow_up_dark",25,6)):1==o?DIV(i,imageSprite("cmp_arrow_down_light",25,6)):DIV(i,imageSprite("cmp_arrow_up_light",25,6))}};var GIstTooltip=Class({holder:null,cur_elm:null,shown:!1,init:function(){!this.holder&&$body()&&(this.holder=DIV({c:"ist_tooltip_holder"}),this.updateAlignment(),$hide(this.holder),$add($body(),this.holder),this._onScroll=$b(this._onScroll,this),$AEV(window,"scroll",this._onScroll))},setAlignment:function(t){this.alignment=t,this.updateAlignment()},showSimpleText:function(t,e,o,i,s,r){var l=this,n=function(n){if($isFunction(o)&&!o(n))return!1;$isFunction(e)&&(e=e(n)),l.show(t,DIV({c:"ist_tooltip_content"},e),n,i,s,r)};$AEV(t,"mouseover",n),$AEV(t,"mouseout",$b(this.hide,this))},showTooltip:function(t,e,o,i,s,r){var l=this;$AEV(t,"mouseover",function(n){var c=e;return $isFunction(e)&&(c=e(n)),c=$isString(c)?$setHTML(DIV({c:"ist_tooltip_content"}),c):DIV({c:"ist_tooltip_content"},c),l.show(t,c,n,o,i,s,r)}),$AEV(t,"mouseout",$b(this.hide,this))},show:function(t,e,o,i,s,r,l){return 1!=r&&(r=!1),this.flip=l,this.cur_elm=t,$setVisibility(e,!1),this.shown=!0,$replace(this.holder,e),this.top_offset=i,this.left_offset=s,this.include_scroll_top=r,$show(this.holder),this.updateAlignment(),$setVisibility(e,!0),this.locate(o),!1},hide:function(t){var e=this;if(e.holder){this.shown=!1;var o=function(){e.shown||($hide(e.holder),e.cur_elm=null,e.top_offset=0,e.left_offset=0)};return $replace(e.holder,null),1==t?o():setTimeout(o,100),!1}},destory:function(){$remove($all("div","IstTooltip_arrow_top",this.holder)),$remove(this.holder),$REV(window,"scroll",this._onScroll),this.holder=null,this._onScroll=null},updateAlignment:function(){$remove($all("div","IstTooltip_arrow_top",this.holder)),this.alignment&&(this.flip?$add(this.holder,DIV({c:"IstTooltip_arrow_top"})):$addToTop(this.holder,DIV({c:"IstTooltip_arrow_top"})))},locate:function(t){var e=this.cur_elm;if(e){var o=$position(e),i=o.x-5,s=this.holder.offsetWidth,r=$winSize().w;$hasClass(e,"IstTooltip_force_right")?(this.setAlignment("right"),$addClass(this.holder,"ist_tooltip_right"),$removeClass(this.holder,"ist_tooltip_left")):$hasClass(e,"IstTooltip_force_left")?(this.setAlignment("left"),$addClass(this.holder,"ist_tooltip_left"),$removeClass(this.holder,"ist_tooltip_right")):i+s+10>r?(i-=s-10-e.offsetWidth,this.setAlignment("right"),$addClass(this.holder,"ist_tooltip_right"),$removeClass(this.holder,"ist_tooltip_left")):(this.setAlignment("left"),$addClass(this.holder,"ist_tooltip_left"),$removeClass(this.holder,"ist_tooltip_right")),$isNumber(this.top_offset)?o.y+=this.top_offset:$isFunction(this.top_offset)&&(o.y+=this.top_offset());var l=null;if($isNumber(this.left_offset)?l=this.left_offset:$isFunction(this.left_offset)&&(l=this.left_offset()),null!=l&&("right"==this.alignment&&(l=-l),i+=l),1==this.flip)var n=o.y-this.holder.offsetHeight;else var n=o.y+e.offsetHeight+2;if($hasClass(e,"fixed_pos")&&(n+=$scrollTop()),this.include_scroll_top&&(n+=$scrollTop()),e.on_ist_tooltip_locate){var c=e.on_ist_tooltip_locate(n,i);n=c[0],i=c[1]}$setTop(this.holder,n),$setLeft(this.holder,i)}},_onScroll:function(){this.locate()}});IstTooltip=new GIstTooltip,$AEV(window,"load",$b(IstTooltip.init,IstTooltip)),IstButton={createButton:function(t,e,o,i){e||(e=null),t&&(t=SPAN(t));var s=A({href:"#",c:"ist_button"},e,t);if(i)for(var r in i)s.setAttribute(r,i[r]);return o&&$addClass(s,"ist_button_"+o),$AEV(s,"mousedown",function(t){return!s.disabled&&($addClass(s,"ist_button_mousedown"),!1)}),$AEV(s,["mouseup","mouseout","click"],function(t){if(s.disabled)return!1;$removeClass(s,"ist_button_mousedown")}),s},createMiniButton:function(t,e,o){var i=IstButton.createButton(null,t,e,o);return $addClass(i,"ist_button_mini"),i},createBigButton:function(t,e,o){var i=IstButton.createButton(t,e,o);return $addClass(i,"ist_button_big"),i},disable:function(t){t&&(t.disabled=!0,$addClass(t,"ist_button_disabled"))},enable:function(t){t&&(t.disabled=!1,$removeClass(t,"ist_button_disabled"))}};var IstComplete={KEY_ENTER:13,KEY_TAB:9,KEY_ESC:27,KEY_SPACE:32,KEY_DELETE:8,KEY_LEFT:37,KEY_RIGHT:39,KEY_UP:38,KEY_DOWN:40,CHAR_FORCED_WHITESPACE:"\u2603",CHAR_CURSOR:"\u15e7",current_input:null,current_data:null,init:function(){var t=DIV({id:"ist_complete_floater"},DIV({id:"ist_complete_result_holder"},TABLE({id:"ist_complete_result"},TBODY())),TABLE({id:"ist_complete_fixed_items"},TBODY()));$hide(t),$add($body(),t)},attach:function(t,e){void 0===e.require_trigger&&(e.require_trigger=!0),void 0===e.support_paste&&(e.support_paste=!0),void 0===e.trigger&&(e.trigger="@"),void 0==e.preselect_match&&(e.preselect_match=!0),void 0===e.sort_results&&(e.sort_results=!0),$AEV(t,"keydown",$p(IstComplete.handleKeyDown,t,e)),$AEV(t,"keypress",$p(IstComplete.handleKeyPress,t,e)),$AEV(t,"compositionend",$p(IstComplete.handleCompositionEnd,t,e)),e.support_paste&&$AEV(t,"paste",function(){setTimeout(function(){IstComplete.hide(),t.istcomplete_word=window.LibEdit.getValue(t),IstComplete.show(t,e,t.value)},30)})},getCurrentWord:function(){var t=IstComplete.current_input;return t?t.istcomplete_word||"":""},isShown:function(){return $isShown($("ist_complete_floater"))},forceShow:function(t,e,o){if(t){if(IstComplete.current_input==t&&$isShown($("ist_complete_floater")))return!1;var i=window.LibEdit.getCursorPosition(t),s=i&&window.LibEdit.isNotWhiteSpace(window.LibEdit.getValue(t).charAt(i-1));return e?(t.proxyGetValue&&""===t.proxyGetValue()&&window.LibEdit.insertAtCursor(t," ",!1),window.LibEdit.isNotWhiteSpace(s)?window.LibEdit.insertAtCursor(t," "+o.trigger,!1):window.LibEdit.insertAtCursor(t,o.trigger,!1),t.istcomplete_word=o.trigger):t.istcomplete_word="",IstComplete.show(t,o,t.istcomplete_word),!1}},show:function(t,e,o){var i=e.collection(o||"");IstComplete._show(t,e,o,i)},_show:function(t,e,o,i){var s=$("ist_complete_floater");window.GB_getLast&&window.GB_getLast()?s.style.zIndex=window.GB_getLast().cur_zindex+1e3:s.style.zIndex=1e3;var r=$child($("ist_complete_result"),"tbody"),l=$child($("ist_complete_fixed_items"),"tbody");IstComplete.current_input=t,IstComplete.current_data=e;var o=o||"",n=o.replace(e.trigger,"");if(o=IstComplete.escapeReqExpSepcails(n),e.wildcard_match)var c=new RegExp(o,"i");else var c=new RegExp("^"+o,"i");var a=[];if($map(i,function(t){var e=t.name;if(e){var o=c.exec(e);!o&&IstComplete.canNormalize()&&(o=c.exec(IstComplete.normalize(e))),o?a.push([o.index,o[0],t]):t.forced&&a.push([0,"",t])}}),o.length>0&&e.sort_results&&a.sort(function(t,e){return t[0]-e[0]}),$map(a,function(t){t.shift()}),$replace(r,null),$replace(l,null),e.onPreProcess&&(a=e.onPreProcess(o,a)),e.onNoMatches&&0===a.length){if(!1===e.onNoMatches(r,t,n))return}else if(0===a.length){var d=e.txt_no_matches_found;d||(d=_("No matches. Press Esc to hide auto-completion.")),$add(r,TR(TD({c:"no_matches"},d)))}else{var p=e.selectedItem&&e.selectedItem(),u=null;$map(a,function(t){var o=t[1],i=o.name,s=i.replace(t[0],"<b>"+t[0]+"</b>");if(o.description&&(s+=" ["+o.description+"]"),e.filterItem&&(s=e.filterItem(o,s)),s){var n;o.fixed_bottom?$add(l,TR(n=TD({c:"ist_complete_item"},s))):$add(r,TR(n=TD({c:"ist_complete_item"},s))),n.onmouseover=$p(IstComplete.onMouseOver,n,o),e.onclick?n.onmousedown=$p(e.onclick,n,o):n.onmousedown=$p(IstComplete.onSelect,n,o,e),p&&p==t[1]&&(u=n)}}),e.preselect_match&&(u||(u=$child(r,"td")),u.onmouseover())}IstComplete._rePosition(t,e),$show(s);var h=$child(document,"td","current_match");try{h.onmouseover(!0)}catch(t){}},hide:function(){IstComplete.current_input&&(IstComplete.current_input.istcomplete_word=""),$hide($("ist_complete_floater")),IstComplete.current_input=null,IstComplete.current_data=null},handleKeyDown:function(t,e,o){if(e==IstComplete.current_data){var i=o.keyAscii;if(IstComplete.isShown()){if(i==IstComplete.KEY_ENTER||i==IstComplete.KEY_TAB)return setTimeout(function(){IstComplete.selectCurrentMatch()},10),$preventDefault(o),!1;if(!1===o.shift){if(i==IstComplete.KEY_LEFT||i==IstComplete.KEY_UP)return IstComplete.selectPrev(o);if(i==IstComplete.KEY_RIGHT||i==IstComplete.KEY_DOWN)return IstComplete.selectNext(o)}if(i==IstComplete.KEY_ESC)return setTimeout(IstComplete.hide,150),!1}if(o.keyAscii==IstComplete.KEY_DELETE){if(o.altKey||o.shiftKey||!$isMac()&&o.ctrlKey)return t.istcomplete_word=e.trigger,!0;if(!e.whole_input_match&&void 0!==t.value&&t.value.length<=1)return IstComplete.hide(),!0;$isMozilla()||IstComplete.handleKeyPress(t,e,o)}}},handleKeyPress:function(t,e,o){e.keyPressListener&&e.keyPressListener(o,t,e);var i,s=e.trigger,r=s.charCodeAt(0);if((e.omni_match||e.whole_input_match)&&o.keyAscii!=IstComplete.KEY_DELETE)t.istcomplete_word=window.LibEdit.getValue(t)+String.fromCharCode(o.keyAscii),i=t.istcomplete_word;else if(o.keyAscii==r)i=t.istcomplete_word=s,IstComplete.current_data=e;else{if(e!=IstComplete.current_data)return!0;i=IstCompleteKeyHandler.handleKeyPress(o,e)}var l=window.LibEdit.getCursorPosition(t);if(o.keyAscii!=IstComplete.KEY_DELETE&&i==s&&l&&window.LibEdit.isNotWhiteSpace(window.LibEdit.getValue(t).charAt(l-1)))return t.istcomplete_word="",!0;o.keyAscii==IstComplete.KEY_DELETE&&""===i&&e.on_delete_empty&&e.on_delete_empty(),e.require_trigger?i&&0===i.indexOf(s)?IstComplete.show(t,e,i):IstComplete.current_data==e&&IstComplete.hide():IstComplete.show(t,e,i)},handleCompositionEnd:function(t,e,o){e.keyPressListener&&e.keyPressListener(o,t,e);var i,s=e.trigger,r=s.charCodeAt(0),l=o.data;if(e.omni_match||e.whole_input_match)t.istcomplete_word=window.LibEdit.getValue(t),i=t.istcomplete_word;else if(l==r)i=t.istcomplete_word=s,IstComplete.current_data=e;else{if(e!=IstComplete.current_data)return!0;t.istcomplete_word?t.istcomplete_word+=l:t.istcomplete_word=""+l,i=t.istcomplete_word}e.require_trigger?i&&0===i.indexOf(s)?IstComplete.show(t,e,i):IstComplete.current_data==e&&IstComplete.hide():IstComplete.show(t,e,i)},selectCurrentMatch:function(){var t=$child(document,"td","current_match");t&&(t.onmousedown(),$removeClass(t,"current_match"))},selectPrev:function(t){return IstComplete._selectGeneric(t,"previousSibling"),!1},selectNext:function(t){return IstComplete._selectGeneric(t,"nextSibling"),!1},onMouseOver:function(t,e,o){$removeClass($all("td","current_match"),"current_match"),$addClass(t,"current_match"),!0===o&&($("ist_complete_floater").scrollTop=$parent(t,"tr").offsetTop)},onSelect:function(t,e,o){var i=IstComplete.current_input,s=i.proxyGetValue,r=i.istcomplete_word,l=e.name,n=new RegExp(IstComplete.escapeReqExpSepcails(o.trigger+l),"i"),c=new RegExp(IstComplete.escapeReqExpSepcails(r)+"(?:$|"+IstComplete.CHAR_CURSOR+"|\\s)","i"),a={is_content_editable:s,input:i,completion_item:e,regexp:n};o.preOnSelect&&o.preOnSelect(a),window.LibEdit.insertAtCursor(i,IstComplete.CHAR_CURSOR);var d=window.LibEdit.getValue(i);d=d.replace(c,""),d=d.replace(IstComplete.CHAR_CURSOR,""),console.log(">",d),window.LibEdit.setValue(i,d);var _=o.trigger+l;if(window.LibEdit.placeCaretAtEnd(i),s&&(_=" "+_+IstComplete.CHAR_FORCED_WHITESPACE),window.LibEdit.insertAtCursor(i,_),o.onSelect)window.LibEdit.setValue(i,o.onSelect(e,i)||"");else{var p=o.trigger+l;window.LibEdit.setValue(i,window.LibEdit.getValue(i).replace(n,p))}return IstComplete.hide(),o.postOnSelect&&o.postOnSelect(a),window.LibEdit.placeCaretAtEnd(i),!1},escapeReqExpSepcails:function(t){return t.replace(/([\+.?*+^$[\]\\(){}|-])/g,"\\$1")},_rePosition:function(t,e){var o=$("ist_complete_floater"),i=$("ist_complete_result_holder");if(o){var s=e.position_item||t,r=$position(s),l=$hasClass(t,"fixed_pos");o.style.position=l?"fixed":"absolute",e.offset_top&&(r.y+=e.offset_top),e.offset_left&&(r.x+=e.offset_left),e.var_height?i.style["max-height"]=e.var_height:i.style["max-height"]="",$setTop(o,r.y+s.offsetHeight-2),$isIe()&&(r.x-=1),$setLeft(o,r.x);var n=s.offsetWidth;e.extra_width&&(n+=e.extra_width),$setWidth(o,n)}},_selectGeneric:function(t,e){var o=$child(document,"td","current_match");if(o){var i=$parent(o,"tr")[e];if(null==i){var s=$parent(o,"tbody").childNodes;s.length>0&&(i="previousSibling"==e?$last(s):$first(s))}try{o=$child(i,"td"),o.onmouseover(!0)}catch(t){}}else{var r=$$("td.ist_complete_item");o="previousSibling"==e?$last(r):$first(r),o&&o.onmouseover(!0)}o&&o.scrollIntoViewIfNeeded&&o.scrollIntoViewIfNeeded(),t&&$preventDefault(t)},canNormalize:function(){return void 0!="".normalize},normalize:function(t){return t.normalize("NFD").replace(/[\u0300-\u036e\u1dc0-\u1dfe\u20d0-\u20fe\ufe20-\ufe2e\u3099-\u309a]+/g,"")}},IstCompleteKeyHandler={handleKeyPress:function(t,e){var o=$eventElm(t),i=e.trigger.charCodeAt(0),s=o.istcomplete_word;if(t.keyAscii==IstComplete.KEY_DELETE&&s&&!t.altKey)o.istcomplete_word=s.substr(0,s.length-1);else if(t.keyAscii==IstComplete.KEY_DELETE)o.istcomplete_word="";else if(t.keyAscii==IstComplete.KEY_SPACE)o.istcomplete_word="";else{if(t.keyAscii==IstComplete.KEY_ESC)return o.istcomplete_word;if(t.keyAscii){if(t.keyAscii!=i&&t.keyAscii<=40&&!t.shift)return o.istcomplete_word;o.istcomplete_word?o.istcomplete_word+=String.fromCharCode(t.keyAscii):o.istcomplete_word=""+String.fromCharCode(t.keyAscii)}}return o.istcomplete_word}},IstCompleteSelect,bind=function(t,e){return function(){return t.apply(e,arguments)}};IstCompleteSelect=function(){function t(t){this.remove=bind(this.remove,this),this.show=bind(this.show,this),this.render=bind(this.render,this),this.showTooltip=bind(this.showTooltip,this),this.collection=t.collection,this.filterItem=t.filterItem,this.onSelect=t.onSelect,this.wildcard_match=t.wildcard_match||!0,this.selectedItem=t.selectedItem,this.txt_no_matches_found=t.txt_no_matches_found,this.placeholder=t.placeholder||"",this.extra_width=t.extra_width||40,this.offset_left=t.offset_left||0}return t.prototype.showTooltip=function(t){var e,o,i,s,r,l,n;return i=t.icon,e=$position(i),r=this.render(t),o=DIV(r.holder),l={fn_left_offset:function(o,i){var s;return $winSize(),s=190,void 0!==t.left_offset&&(s=t.left_offset),e.x-s},fn_top_offset:function(){return $winSize().w<450?0:e.y+(t.top_offset||0)},fn_arrow_left:function(){return e.x+(t.arrow_left_offset||0)},fn_on_hide:function(e){return function(){if($removeClass($("ist_complete_floater"),"in_ist_select"),$removeClass(i,"always_show"),e.remove(),t.fn_on_hide)return t.fn_on_hide()}}(this),fixed_pos:$hasClass(i,"fixed_pos")},s=$("ist_complete_floater"),s||(IstComplete.init(),s=$("ist_complete_floater")),$hasClass(i,"fixed_pos")?s.style.position="fixed":s.style.position="",n=TooptipWin.show(t.title,o,210,265,l),this.show(),$addClass(s,"in_ist_select"),FocusElm.focus(o),n},t.prototype.render=function(t){var e,o,i;return e={type:"text",autocomplete:"off"},this.placeholder&&(e.placeholder=this.placeholder),o=DIV({c:"ist_complete_select"},i=INPUT(e),DIV({c:"results_holder"})),$hasClass(t.icon,"fixed_pos")&&$addClass(i,"fixed_pos"),this.input=i,this.complete_data={selectedItem:this.selectedItem,txt_no_matches_found:this.txt_no_matches_found,collection:this.collection,filterItem:this.filterItem,onSelect:this.onSelect,wildcard_match:this.wildcard_match,require_trigger:!1,whole_input_match:!0,extra_width:this.extra_width,offset_top:14,offset_left:-19},IstComplete.attach(i,this.complete_data),{holder:o,input:i}},t.prototype.show=function(){return this.input.focus(),setTimeout(function(t){return function(){return IstComplete.forceShow(t.input,!1,t.complete_data)}}(this),30)},t.prototype.remove=function(){return IstComplete.hide(),this.input=null,this.collection=null,this.filterItem=null,this.onSelect=null,this.wildcard_match=null},t}(),window.DISABLE_GB_AUTO_RESIZE=!1,window.MIN_HEIGHT=250,window.$AEV&&($AEV(window,"lazy_load",$p(updateGBDimensions,null,null),!0),$AEV(window,"load",$p(updateGBDimensions,null,null),!0));
